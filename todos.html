<!DOCTYPE html>
<html lang="en">

<head>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.1.3/dist/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JQuery Example</title>
</head>

<body>
    <nav aria-label="nav" class="navbar navbar-expand-lg" style="background-color: #e3f2fd;">
        <div class="container-fluid">
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="nav nav-pills">
                    <li class="nav-item">
                        <a class="nav-link" aria-current="page" href="index.html">Users</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="posts.html">Posts</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="albums.html">Albums</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link active" href="todos.html">Todos</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <table class="table table-hover table-dark"
        style="width:70%; margin-left:auto; margin-right:auto; margin-top:50px;">
        <thead>
            <tr>
                <th scope="col">Completed</th>
                <th scope="col">Title</th>
                <th scope="col">Id</th>
                <th scope="col">UserId</th>
            </tr>
        </thead>
        <tbody id="body-table">


        </tbody>
    </table>

    <script>
        $(document).ready(function () {
            $.ajax({
                url: 'https://jsonplaceholder.typicode.com/todos',
                method: 'GET',
                success: function (data) {
                    loadTable(data);
                },
                error: function () {
                    loadTableError();
                }
            });
        })

        function loadTable(data) {
            data.forEach(todo => {
                if (todo.completed) {
                    var row = "<tr class='bg-success tr'>" +
                        "<th scope = 'row'>" + todo.completed + "</th>" +
                        "<td>" + todo.title + "</td>" +
                        "<td>" + todo.id + "</td>" +
                        "<td>" + todo.userId + "</td>" +
                        "</tr> ";
                }
                else {
                    var row = "<tr class='tr' id='t" + todo.id + "'>" +
                        "<th scope = 'row'>" + todo.completed + "</th>" +
                        "<td>" + todo.title + "</td>" +
                        "<td>" + todo.id + "</td>" +
                        "<td>" + todo.userId + "</td>" +
                        "</tr> ";

                    var card = "<div class='card' id='dt" + todo.id + "'  style='width: 18rem; display:none'>" +
                        "<div class='card-body'>" +
                        "<h5 class='card-title'>UserId: " + todo.userId + " TodoId: " + todo.id + "</h5>" +
                        "<p class='card-text'>" + todo.title + "</p>" +
                        "<a href='#' class='btn btn-primary' id='" + todo.id + "'>Completed</a>" +
                        "<a href='#' class='btn btn-danger' id='" + todo.id + "'>Close</a>" +
                        "</div>" +
                        "</div>";
                    $("body").append(card);
                }
                $("#body-table").append(row);
            });

            var btnPrimary = $(".btn-primary");

            btnPrimary.click(function () {
                var tr = $("#t" + $(this).attr("id"));
                var div = $("#dt" + $(this).attr("id"));
                div.fadeOut();
                tr.addClass("bg-success");
                tr.children('th').text("true");

            });

            var btnDanger = $(".btn-danger");

            btnDanger.click(function () {

                var div = $("#dt" + $(this).attr("id"));
                div.fadeOut();

            });

            $(".tr").click(function () {
                var tr = $(this);

                if (tr.children('th').text() == "false") {
                    var idCard = tr.attr("id");
                    $("#d" + idCard).css({ "position": "absolute", "z-index": "100", "top": "" + (tr.offset().top + 50) + "px", "left": "" + (tr.offset().left + 100) + "px" }).fadeIn();
                }
                else {
                    tr.toggleClass("bg-success");
                    tr.children('th').text("false");
                }
            });
        }

        function loadTableError() {
            var row = "<tr class='table-danger'><td colspan='4'>Error: todos not found</td></tr>";
            $("#body-table").append(row);
        }




    </script>

</body>


</html>